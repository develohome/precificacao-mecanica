<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Or√ßamento Oficina Mec√¢nica</title>

<!-- BOOTSTRAP -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- jsPDF AutoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

</head>
<body class="bg-light">

<div class="container mt-4 bg-white p-4 rounded shadow">

<h2 class="text-center mb-4">üöó Sistema de Or√ßamento Mec√¢nico</h2>

<div class="row">
  <div class="col-md-4">
    <label>Nome da oficina</label>
    <input id="oficina" class="form-control" value="Rio Pneus">
  </div>
  <div class="col-md-4">
    <label>Cliente</label>
    <input id="cliente" class="form-control">
  </div>
  <div class="col-md-4">
    <label>Ve√≠culo</label>
    <input id="veiculo" class="form-control" placeholder="Ex: Gol 1.6 2015">
  </div>
</div>

<hr>

<!-- <div class="row">
  <div class="col-md-4">
    <label>Custo mensal da oficina (R$)</label>
    <input type="number" id="custoMensal" class="form-control">
  </div>
  <div class="col-md-4">
    <label>Horas trabalhadas no m√™s</label>
    <input type="number" id="horasMes" class="form-control">
  </div>
  <div class="col-md-4">
    <label>Lucro sobre m√£o de obra (%)</label>
    <input type="number" id="lucro" class="form-control" value="40">
  </div>
</div>

<hr> -->

<h5>Adicionar servi√ßo</h5>

<div class="row">
  <div class="col-md-4">
    <label>Servi√ßo</label>
    <select id="servico" class="form-select">
      <option value="0.5">Troca de √≥leo (0,5h)</option>
      <option value="1">Pastilhas de freio (1h)</option>
      <option value="2">Amortecedores (2h)</option>
      <option value="3">Correia dentada (3h)</option>
      <option value="6">Embreagem (6h)</option>
      <option value="2">Limpeza de bicos (2h)</option>
      <option value="4">Revis√£o completa (4h)</option>
      <option value="1">Troca de bateria (1h)</option>
    </select>
  </div>

  <div class="col-md-2">
    <label>Pe√ßa (R$)</label>
    <input type="number" id="peca" class="form-control" value="0">
  </div>

  <div class="col-md-2">
    <label>Lucro pe√ßa (%)</label>
    <input type="number" id="lucroPeca" class="form-control" value="30">
  </div>

  <div class="col-md-2">
    <label>Materiais (R$)</label>
    <input type="number" id="materiais" class="form-control" value="0">
  </div>

  <div class="col-md-2 d-flex align-items-end">
    <button onclick="adicionarServico()" class="btn btn-success w-100">Adicionar</button>
  </div>
</div>

<hr>

<table class="table table-bordered" id="tabela">
<thead class="table-dark">
<tr>
<th>Servi√ßo</th>
<th>M√£o de obra (R$)</th>
<th>Pe√ßa (R$)</th>
<th>Total (R$)</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="row">
  <div class="col-md-4">
    <label>Desconto (%)</label>
    <input type="number" id="desconto" class="form-control" value="0">
  </div>
  <div class="col-md-8 d-flex align-items-end">
    <button onclick="finalizar()" class="btn btn-primary w-100">Calcular total</button>
  </div>
</div>

<div class="alert alert-success mt-3" id="resultado"></div>

<button onclick="gerarPDF()" class="btn btn-danger w-100 mt-2">Gerar PDF</button>

</div>

<script>
let totalGeral = 0;

function adicionarServico(){
    let custoMensal = 5000 // parseFloat(custoMensal.value);
    let horasMes = 178 // parseFloat(horasMes.value);
    let lucro = 40 // parseFloat(lucro.value)/100;

    let tempo = parseFloat(servico.value);
    let nomeServico = servico.options[servico.selectedIndex].text;

    let pecaVal = parseFloat(peca.value);
    let lucroP = parseFloat(lucroPeca.value)/100;
    let materiaisVal = parseFloat(materiais.value);

    let horaTecnica = (custoMensal/horasMes)*(1+lucro);
    let maoDeObra = horaTecnica * tempo;
    let precoPeca = pecaVal * (1+lucroP);
    let total = maoDeObra + precoPeca + materiaisVal;

    let tbody = document.querySelector("#tabela tbody");
    let row = tbody.insertRow();
    row.insertCell(0).innerText = nomeServico;
    row.insertCell(1).innerText = maoDeObra.toFixed(2);
    row.insertCell(2).innerText = precoPeca.toFixed(2);
    row.insertCell(3).innerText = total.toFixed(2);

    totalGeral += total;
}

function finalizar(){
    let desc = parseFloat(desconto.value)/100;
    let final = totalGeral * (1-desc);

    resultado.innerHTML =
      "<b>Total bruto:</b> R$ " + totalGeral.toFixed(2) + "<br>" +
      "<b>Desconto:</b> " + (desc*100) + "%<br>" +
      "<b>Total final:</b> R$ " + final.toFixed(2);
}

function gerarPDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // ===== DATA E HORA ATUAL =====
    let agora = new Date();
    let data = agora.toLocaleDateString("pt-BR");
    let hora = agora.toLocaleTimeString("pt-BR");

    // ===== DADOS PRINCIPAIS =====
    let oficinaNome = oficina.value;
    let clienteNome = cliente.value;
    let veiculoNome = veiculo.value;

    // ===== TABELA DE DADOS (OFICINA / CLIENTE / VE√çCULO) =====
    doc.autoTable({
        head: [["Campo", "Informa√ß√£o"]],
        body: [
            ["Oficina", oficinaNome],
            ["Cliente", clienteNome],
            ["Ve√≠culo", veiculoNome]
        ],
        startY: 10
    });

    // ===== TABELA DE SERVI√áOS =====
    let dadosServicos = [];
    let rows = document.querySelectorAll("#tabela tbody tr");

    rows.forEach(r => {
        let cols = r.querySelectorAll("td");
        dadosServicos.push([
            cols[0].innerText,
            "R$ " + cols[1].innerText,
            "R$ " + cols[2].innerText,
            "R$ " + cols[3].innerText
        ]);
    });

    let posicaoServicos = doc.lastAutoTable.finalY + 10;

    doc.autoTable({
        head: [["Servi√ßo", "M√£o de obra", "Pe√ßa", "Total"]],
        body: dadosServicos,
        startY: posicaoServicos
    });

    // ===== TABELA DE RESUMO =====
    let texto = resultado.innerText.split("\n");

    let totalBruto = texto[0].replace("Total bruto: ", "");
    let desconto = texto[1].replace("Desconto: ", "");
    let totalFinal = texto[2].replace("Total final: ", "");

    let resumoTabela = [
        ["Total bruto", totalBruto],
        ["Desconto", desconto],
        ["Total final", totalFinal]
    ];

    let posicaoResumo = doc.lastAutoTable.finalY + 10;

    doc.autoTable({
        head: [["Resumo", "Valor"]],
        body: resumoTabela,
        startY: posicaoResumo
    });

    // ===== RODAP√â COM DATA E HORA =====
    let pageHeight = doc.internal.pageSize.height;
    doc.setFontSize(10);
    doc.text(
        "Or√ßamento gerado em: " + data + " √†s " + hora,
        14,
        pageHeight - 10
    );

    doc.save("orcamento.pdf");
}




</script>

</body>
</html>
